Что мы хотим?
Скорости (быстрой сборки)
Безопасность
Удобство

Как можно затюнить?
Несколько раз использовать команду RUN
Можно например сделатьтак
RUN apt-get update && apt-get install-y \
nginx

мы таким образом сэкономили 1 слой.
Также некоторые библиотеки создают кэши, которые нам в контейнере не нужны
и можно в команде дописать && rm -rf /var/lib/apt/lists/*

сборщики кода зачастую формируют кэш.

Таким образом на примере nginx мы получаем из 222Мб
204Мб

Что дальше?
использовать dockerignore
выкинуть из контейнера лишние папки
dockerfile внутри контейнера тоже не нужен если что

можно поставить минималистичный линукс, например alpine вместо debian

по итогу отказавшись от debian мы получили образ 7 Мб
и это офигенно!!!!

Мы поствили второй строчкой COPY для копирования
и бест практис нам говорит что все слои,которые будут часто изменяться
лучшеставить в конец файла

Те слои, которые не изменяются используются из кэша

Указание базового как например alpine достаточно рискованно
лучше указывать точную версию базового имеджа

стоит указывать ссылку на репозиторий

можно использвать ENV NGINX_VERSION 1.16
а в коде указать ${NGINX_VERSION}

ENTRYPOINT
CMD
обе команды делают по факту одно и тоже
разработчики докера советуют в ENTRYPOINT засовывать бинать
а в CMD флаги с которыми этот бинарь нужно запустить

Усиливаем контроль и Безопасность
1) не используем latest
2) 1 процесс 1 контейнера
3) указываем явные версии по
4) The Twelve-factor app - статья, которую нужно прочесть
5) Нужен сборщик логов
6) настроить ENV
7) ресурс менеджмент (важно знать сколько ресов)
8) минимум привилегий процесса в контейнере (root, host network)
9) собираем свои образы и тестим (snyk - сайт по тестированию образов)

Docker-Compose:
система, которая дает возможность поднимать несколько контейнеров
docker-compose.yaml

services - контейнеры
image - образ
ports - открыть порты
volumes - проброс папок

docker-compose build
docker-compose up -d
docker-compose down
docker-compose logs -f <имясервиса>
docker-compose ps вывод списка контейнеров
docker-compose exec <контейнер> <команда>
docker-compose images

docker-compose по крайней мере 2 емеет helthchek

WORKDIR - она может создать папку если ее нет поэтому можно не использовать команду mkdir

для прода используем image, которые уже собрали
он взял имедж локально но мы можем получать их и из оркестратора









